\chapter{System Description}
\label{sec:system}

In the following, we describe the system.
Figure~\ref{fig:system} gives an overview.
The transmitters on the left are assumed to be widely spaced, so that they experience no coupling between themselves.
The signals are transmitted over a spatial interference channel such that seach signal reaches every receiver.
\begin{figure}[h]
\begin{center}
\includegraphics[width=\textwidth]{images/System.png}
\caption{Overview of the system.}
\label{fig:system}
\end{center}
\end{figure}

In addition to the receivers themselves, there are passive relays on the right side.
The relays and  receivers are closely spaced, therefore the channels between transmitters, receivers and relays are spatially correlated and the elements on the receiver side experience coupling among themselves.

\section{Spatial Channel}
\label{sec:spatial}

As mentioned in the previous section the spatial channel is generated by spatial correlation among the receivers and the relays, dependent on the distance.
The correlation matrix is generated by the Besselfuntion according to
\begin{equation}
\label{eq:spatial_corr}
R_{i,j} = J_0\left(2\cdot \pi\cdot \frac{d_{i,j}}{\lambda}\right),
\end{equation}
where $J_0(x)$ is the 0-th Besselfunction~\cite[p.191]{Kreyszig} and $d_{i,j}$ the distance between receiving element $i$ and $j$ (receiving antennas and relays are concatenated).
Therefore $\mat{R}$ is symmetric with 1 on its diagonal, as $J_0(0)=1$.

\begin{figure}[h]
\begin{center}
\includegraphics[width=\textwidth]{images/antennae_position.png}
\caption{Example of the receive antenna and the relay placing.}
\label{fig:antenna_placing}
\end{center}
\end{figure}

The spatial channel from the $n$-th transmitter to all receivers an relays is then generated by
\begin{equation}
\label{eq:spatial_channel}
\mat{H}_{n}^{\text{sp}} = \mat{R}^{\frac{1}{2}}\cdot\mat{H}_\text{IID},
\end{equation} 
where $\mat{H}_\text{IID}$ is a matrix of size $\mathbb{C}^{N_\text{R}\cdot \left(N_\text{Rx} + N_\text{Rel}\right) \times N_\text{Tx}}$, with complex elements drawn from the standard normal distribution ($\mu = 0$ and $\sigma = 1$).
Therefore $\mat{H}_{n}^{\text{sp}}$ is of size $\mathbb{C}^{N_\text{R}\cdot \left(N_\text{Rx} + N_\text{Rel}\right) \times N_\text{Tx}}$.


\section{Receiver Circuit Description}
\label{sec:network_description}
As mentioned in Section~\ref{sec:SoA}, the idea of describing receiver circuitry is based on the work of~\cite{Nossek}.
To do so, we represent each receiver block (shown in Figure~\ref{fig:receiver}) using n-ports.
A short overview on two-ports (simplified n-ports) is given in the following.

\subsection{Multi-Port Networks}
\label{sec:multiport_networks}

This section starts with an analysis of a two-port network.
Later, this can be easily extended to a multi-port, or n-port network.
\begin{figure}[h]
\begin{center}
\includegraphics[width=0.75\textwidth]{images/twoport.png}
\caption{A two-port network~\cite{magnus:twoport}.}
\label{fig:twoport}
\end{center}
\end{figure}

Figure~\ref{fig:twoport} shows a two-port network.
The two-port network can be represented by an impedance matrix $\mat{Z}$.
The elements $Z_{ij}$ of the matrix are defined in the following way:
\begin{align}
\label{eq:multiport_impedance}
Z_{ij} &= \frac{V_i}{I_j},\\\nonumber
&\text{for the currents}\quad I_l = 0,\quad l\neq j.
\end{align}
Therefore the two-port's input/output relations can be written as
\begin{align}
\label{eq:twoport_io}
\begin{bmatrix}
V_1\\V_2
\end{bmatrix} &= \mat{Z} \cdot
\begin{bmatrix}
I_1\\I_2
\end{bmatrix}
\end{align}

For a n-port network, the voltage and current elements can be represented as vectors on length $n$, and the elements $Z_{ij},\quad i,j\in\{1,2\}$ become sub-matrices.
Looking from the left into the network with loads $R_L$ attached to the ports on the right, the equivalent input impedance matrix becomes
\begin{equation}
\label{eq:eq_imp_load}
\mat{Z}_{\text{eq}_1} = \mat{Z}_{11} - \mat{Z}_{21}\cdot(\mat{Z}_{22} + R_L\cdot\mat{I})^{-1}\cdot \mat{Z}_{12}.
\end{equation}
With no load attached on port two (open circuited ports, or $R_L\rightarrow\infty$), the equivalent input impedance becomes
\begin{equation}
\label{eq:eq_imp_oc}
\mat{Z}_{\text{eq}_1} = \mat{Z}_{11}.
\end{equation}
Last, having port one short-circuited (i.e.  $R_L\rightarrow 0$) and looking from port two into the network, the equivalent network impedance becomes
\begin{equation}
\label{eq:eq_imp_sc}
\mat{Z}_{\text{eq}_2} = \mat{Z}_{22} - \mat{Z}_{12}\cdot(\mat{Z}_{11})^{-1}\cdot \mat{Z}_{21}.
\end{equation}
For reciprocal networks (\textit{RLC}-Networks, containing only passive elements), the following property holds: $\mat{Z}_{12} = \mat{Z}_{21}^T$.


\subsection{Receiver Blocks}
\begin{figure}[h]
\centering
  \includegraphics[width=0.9\linewidth]{images/Full_Receiver.png}
\caption{The receiver, with the coupling network $\mat{Z}_\text{C}$, the SP-matching network $\mat{Z}_\text{M}$, the LNA, and loads attached to the LNA.}
\label{fig:receiver}
\end{figure}
The receiver (as shown in Figure~\ref{fig:receiver}) consists of three blocks.
From left to right:
\begin{enumerate}
\item{the coupling network ($\mat{Z}_\text{C}$),}
\item{the matching network ($\mat{Z}_\text{M}$), and}
\item{the low-noise-amplifier ($\mat{LNA}$).}
\end{enumerate}
 
All of these blocks can be described as multi-port networks.
In the following each block is discussed.

\subsubsection{The Coupling Network}
\label{sec:coupling_network}
The coupling network is introduced, as a compact antenna spacing is assumed on the receiver side.
The strength of the coupling between two antennas depends on the type of the antennas and the spacing between themselves.
We model the antennas as half wavelength dipoles.
As the effect of coupling from one antenna to another is the same as the reverse, the impedance matrix $\mat{Z}_\text{C}$ becomes symmetric.
Coupling among antennas is calculated by the ``EWA''-Toolbox for MATLAB~\cite{Orfanidis}.
The theory underlying this can be found in~\cite[Chapter 23]{Orfanidis}.

\subsubsection{The Matching Network}
\label{sec:matching_network}
In order to improve the performance of the receiver, a matching network is placed after each receiving antenna.
For complexity and bandwidth reasons, single-port (SP) matching is assumed~\cite{Yahia2013}.
The matching network has the form of 
\begin{equation}
\mat{Z}_\text{M}=
\begin{bmatrix}
\mat{Z}_\text{M11} & \mat{Z}_\text{M12} \\
\mat{Z}_\text{M21} & \mat{Z}_\text{M22}
\end{bmatrix}.
\end{equation}
For a matching network to be lossless, it must be purely imaginary and symmetric~\cite{Nossek}.
Because we assume SP matching, the sub-matrices become diagonal.
With the choice of a reciprocal network, additionally following property holds: $\mat{Z}_\text{M12} = \mat{Z}_\text{M21}^T \implies \mat{Z}_\text{M12} = \mat{Z}_\text{M21}$.
Further, the network can be represented as a T-network, which is shown in Figure~\ref{fig:t_netw}.
\begin{figure}[h]
\centering
  \includegraphics[width=0.7\linewidth]{images/T-Network.png}
\caption{Schematic of a reciprocal T-network.}
\label{fig:t_netw}
\end{figure}

\subsubsection{The Low-Noise-Amplifier}
\label{sec:lna}
In the LNA block the received signal is amplified after the matching network.
As in the matching network, the LNA can be represented in the following way
\begin{equation}
\mat{LNA}=
\begin{bmatrix}
\mat{c} & \mat{d} \\
\mat{e} & \mat{g}
\end{bmatrix}.
\end{equation}
As each branch has its own LNA, the sub-matrices $\mat{c},\mat{e},$ and $\mat{g}$ are again diagonal.
Additionally, matrix $\mat{d}$ is an all-zeros matrix under the unilateral assumption (\textit{the input of the LNA is not affected by the output of the LNA}).




\subsection{Port Reduction}
\label{sec:port_reduction}

In the following, we describe the open circuit reduction of a system like that in Figure~\ref{fig:port_reduction}.
We perform port reduction because we are interested in the signal only at the loads of the corresponding receiver.
The signal picked up at relay antennae or receivers not considered contributes to the signal at the considered receiver through the coupling between the antennas, as described in Section~\ref{sec:coupling_network}.
The passive relays are modeled by connecting an impedance directly to the coupling network as shown in the lowest two branches on the left in Figure~\ref{fig:port_reduction}.
Undesired receivers can be modeled in the same manners as the relays, with the load corresponding to the equivalent input impedance of the matching network (as in Equation~\eqref{eq:zeqm1}) shown by the third lowest branch on the left in Figure~\ref{fig:port_reduction}.

In the following, $\vec{v}_{\text{C}i}$ denotes the parallel voltages on the ports at the coupling matrix $\mat{Z}_\text{C}$ and $\vec{i}_{\text{C}i}$ denotes the same for the currents.
As we are not interested in the input/output relationships between these passive antennas, a port reduction is performed.
For the port reduction, the coupling matrix $\mat{Z}_\text{C}$ can be represented by four sub-matrices
\begin{equation}
\mat{Z}_\text{C}=
\begin{bmatrix}
\mat{Z}_\text{OO} & \mat{Z}_\text{OL}\\
\mat{Z}_\text{LO} & \mat{Z}_\text{LL}
\end{bmatrix},
\end{equation}
so that we get the system relations

\begin{align}
\label{eq:ocl_matrix}
\begin{bmatrix}
\vec{v}_\text{CO} \\
\vec{v}_\text{CL}
\end{bmatrix}
=
\begin{bmatrix}
\mat{Z}_\text{OO} & \mat{Z}_\text{OL}\\
\mat{Z}_\text{LO} & \mat{Z}_\text{LL}
\end{bmatrix}\cdot
\begin{bmatrix}
\vec{i}_\text{CO} \\
\vec{i}_\text{CL}
\end{bmatrix}.
\end{align}
The index O denotes the ports of the required receiver branches, which are open-circuited, the index L represents ports of the non-required receivers and the relays (i.e. the ports with an impedance attached or loaded, respectively).
Therefore, $\mat{Z}_\text{OO}$ is of size $\mathbb{C}^{N_\text{Rx}\times N_\text{Rx}}$,
	$\mat{Z}_\text{OL}$ of size $\mathbb{C}^{N_\text{Rx}\times N_\text{R}\cdot\left(N_\text{Rx}+N_\text{Rel}\right)}$, and
	$\mat{Z}_\text{LL}$ of size $\mathbb{C}^{ N_\text{R}\cdot\left(N_\text{Rx}+N_\text{Rel}\right)\times N_\text{R}\cdot\left(N_\text{Rx}+N_\text{Rel}\right)}$.
The indices will change depending on the user.
Without loss of generality, we will derive the port reduction only for the first receiver (receiver 0 in the following.
We assume that there are $N_\text{R} \cdot N_\text{Rx}$ antennas, whereof the first $N_{Rx}$ antennas are active (i.e. are the receive antenna of user 0) and the later ones are passive (i.e. the antennas of the relays and of the other users).
$\mat{Z}_{\text{pass}}$ denotes in the following the $(N_\text{R}-1)\cdot N_\text{Rx}$ equivalent input impedances $\mat{Z}_{\text{eqM1}}$ of the non-required receivers and the $N_\text{Rel}$ impedances representing the relays $\mat{X}_{\text{Rel}}$, placed on the diagonal of a $\mathbb{C}^
	{(N_\text{R}-1)\cdot N_\text{Rx}+N_\text{R}N_\text{Rel}
	\times (N_\text{R}-1)\cdot N_\text{Rx}+N_\text{R}N_\text{Rel}}$ square matrix.
\begin{figure}[h]
\begin{center}
\includegraphics[width=0.75\textwidth]{images/Port_reduction.png}
\caption{Port reduction on a network with one load connected to the last port.}
\label{fig:port_reduction}
\end{center}
\end{figure}

From Equation~\eqref{eq:ocl_matrix} and the property
\begin{align}
\vec{v}_\text{CL} &= \vec{v}_O[N_{Rx}+1:N_R\cdot N_{Rx}]-\mat{Z}_{\text{pass}}\cdot\vec{i}_\text{CL}
\\\nonumber\quad\text{it follows that}&\\
\vec{i}_\text{CL} &= -(\mat{Z}_{\text{pass}} + \mat{Z}_\text{LL})^{-1}\mat{Z}_\text{LO}\cdot\vec{i}_\text{CO} -\\\nonumber
&\qquad (\mat{Z}_{\text{pass}} + \mat{Z}_\text{LL})^{-1}\cdot\vec{v}_{0}[N_i+1:N_R]\\\nonumber\quad\text{and therefore,}&\\
\vec{v}_\text{CO} &= (\mat{Z}_\text{OO}-\mat{Z}_\text{OL}(\mat{Z}_{\text{pass}} + \mat{Z}_\text{LL})^{-1}\mat{Z}_\text{LO})\cdot\vec{i}_\text{CO} -\\\nonumber&\qquad \mat{Z}_\text{OL}(\mat{Z}_{\text{pass}} + \mat{Z}_\text{LL})^{-1}\cdot\vec{v}_0[N_{Rx}+1:N_R\cdot N_{Rx}].
\end{align}
With this port reduction, the equivalent coupling matrix $\mat{Z}_\text{C}^{'}$ and input voltage $\vec{v}_0^{'}$ for receiver 0 become
\begin{align}
\label{eq:zc_eq}
\mat{Z}_\text{C}^{'}&= \mat{Z}_\text{OO} - \mat{Z}_\text{OL}(\mat{Z}_{\text{pass}} + \mat{Z}_\text{LL})^{-1}\mat{Z}_\text{LO}\quad\text{and}\\\nonumber
\vec{v}_0^{'} &= \mat{H}_0^{\text{pr}} \cdot\mat{H}_{j}^{\text{sp}}\cdot \vec{v}_j,\\
\label{eq:port_reduction}
&\text{with}\quad\mat{H}_0^{\text{pr}}=
\begin{bmatrix}
\mat{I}_{N_\text{Rx}} & -\mat{Z}_\text{OL}(\mat{Z}_{\text{pass}} + \mat{Z}_\text{LL})^{-1}
\end{bmatrix},
\end{align}
for any transmitter $j$, with $j\in\{0,...,N_\text{T}-1\}$.
It is easy to see that $\mat{Z}_\text{C}^{'}$ has size $\mathbb{C}^{N_\text{Rx}\times N_\text{Rx}}$.
Further, $\vec{v}_0^{'}$ is of length $\mathbb{C}^{N_\text{Rx}\times 1}$, as 
$\mat{H}_0^{\text{pr}}$ is of size 
	$\mathbb{C}^{N_\text{Rx}\times N_\text{R}\cdot\left(N_\text{Rx}+N_\text{Rel}\right)}$ 
and $\mat{H}_j^{\text{sp}}$ has size 
	$\mathbb{C}^{N_\text{R}\cdot\left(N_\text{Rx}+N_\text{Rel}\right)\times N_\text{T}N_\text{Tx}}$.
Therefore we can reduce the system shown in Figure~\ref{fig:receiver}, to a simpler system, which only considers the branches of the receiving antenna.





\subsection{Transfer Function of the Receiver}
\label{sec:transf}
Our main interest lies in the transfer function $\mat{H}_{\text{L},i}$ of the input voltages $\mat{H}_j^{\text{sp}}\cdot\vec{v}_\text{j}$ to the voltage measured at the loads (in Figure~\ref{fig:receiver}) $\vec{v}_{\text{L},i}$.
In this the signal is transmitted by user $j$ and received by user $i$.

In the following the transfer function for each block of the receiver is derived.
We use the following terminology: $\vec{v}_l$ are the voltages on the left of the block $l$ (e.g. $\vec{v}_\text{M}$ are the voltages on the left ports of the matching network).
Also, for simplicity reasons the index of the receiver blocks corresponding to the user $i$.
Additionally, we see the left ports as input ports and the right ports as output ports for each block.
We need four equivalent impedance matrices for the derivation of the transfer function, namely:
\begin{enumerate}
\item{$\mat{Z}_\text{eqM1}$, the impedance matrix looking from the left into the matching network,}
\item{$\mat{Z}_\text{eqM2}$, the impedance matrix looking from the right into the matching network,}
\item{$\mat{Z}_\text{eqLNA1}$, the impedance matrix looking from the left into the LNA, and}
\item{$\mat{Z}_\text{eqLNA2}$, the impedance matrix looking from the right into the LNA.}
\end{enumerate}

To calculate $\mat{Z}_\text{eqM1}$ and $\mat{Z}_\text{eqLNA1}$, we use Equation~\eqref{eq:eq_imp_load} and the unilateral assumption ($\mat{d}=0$) to find
\begin{align}
\label{eq:zeqm1}
\mat{Z}_\text{eqM1} &= \mat{Z}_\text{M11} - \mat{Z}_\text{M21}\cdot(\mat{Z}_\text{M22} + \mat{Z}_\text{eqLNA1})^{-1}\cdot\mat{Z}_\text{M12},\quad\text{and}\\
\label{eq:zeqlna1}
\mat{Z}_\text{eqLNA1} &= \mat{c} - \mat{e}\cdot(R_L\mat{I}_{N_R} + \mat{g})^{-1}\cdot\mat{d} = \mat{c}.
\end{align}
For our calculations we assume that port reduction has been performed on the system.
Hence, the sub-matrices of the matching network and the LNA~---~and therefore also the equivalent input impedance matrices~---~are of size $\mathbb{C}^{N_\text{Rx}\times N_\text{Rx}}$.

As we step through the receiver blocks from left to right, we always apply the parallel voltages to each receiver block on the left.
Therefore, the equivalent input impedances $\mat{Z}_\text{eqM2}$ and $\mat{Z}_\text{eqLNA2}$ can be derived using the unilateral assumption again and Equation~\eqref{eq:eq_imp_oc}, which leads to:
\begin{align}
\label{eq:zeqm2}
\mat{Z}_\text{eqM2} &= \mat{Z}_\text{M22} - \mat{Z}_\text{M12}\cdot(\mat{Z}_\text{M11})^{-1}\cdot\mat{Z}_\text{M21},\quad\text{and}\\
\label{eq:zeqlna2}
\mat{Z}_\text{eqLNA2} &= \mat{g} - \mat{d}\cdot(\mat{c})^{-1}\cdot\mat{e} = \mat{g}.
\end{align}

To attain the parallel input voltages on the left of the matching network, we use the principle of a voltage divider, which is
\begin{equation}
\vec{v}_\text{M} = \mat{Z}_\text{eqM1}\cdot(\mat{Z}_\text{eqM1} + \mat{Z}_\text{C})^{-1} \mat{H}_i^{\text{pr}}\cdot\mat{H}_{j}^{\text{sp}}\cdot \vec{v_j}.
\end{equation}

To transfer the voltages from the left ports to the right ports of each block, we proceed for each block in the following manner: 
\begin{enumerate}
\item{Calculate the input currents,}
\item{Transfer the input currents to the output voltages in series, and}
\item{Calculate the output voltages in parallel using a voltage divider.}
\end{enumerate}
For the matching network, it follows that:
\begin{align}
\vec{i_M} &= \mat{Z}_\text{M11}^{-1}\cdot\vec{v}_\text{M},\\
\vec{v}_{\text{LNA}_\text{series}} &= \mat{Z}_\text{M12}\cdot\vec{i_M} = \mat{Z}_\text{M12} \mat{Z}_\text{M11}^{-1}\cdot\vec{v}_\text{M},\\
\vec{v}_\text{LNA} &= \mat{Z}_\text{eqLNA1}(\mat{Z}_\text{eqLNA1}+\mat{Z}_\text{eqM2})^{-1}\cdot\vec{v}_{\text{LNA}_\text{series}}\\\nonumber
&=\mat{Z}_\text{eqLNA1}(\mat{Z}_\text{eqLNA1}+\mat{Z}_\text{eqM2})^{-1}\mat{Z}_\text{M12} \mat{Z}_\text{M11}^{-1}\cdot\vec{v}_\text{M},
\end{align}
and equivalently for the LNA block:
\begin{align}
\vec{v_{L}}&=R_L\mat{I}_{N_\text{Rx}}(R_L\mat{I}_{N_\text{Rx}}+\mat{Z}_\text{eqLNA2})^{-1}\mat{e}\cdot\mat{c}^{-1}\cdot\vec{v}_\text{LNA}.
\end{align}

Therefore we have four sub-transfer functions in total, including the port reduction transfer function, to describe the receiver side.
Denoting the transfer function form voltage $\vec{v}_j$ to voltage $\vec{v}_i$ as $\mat{H}_{i,j}$ (i.e. $\vec{v}_i = \mat{H}_{i,j} \cdot\vec{v}_j$), it follows that
\begin{align}
\mat{H}_\text{M,O'} &= \mat{Z}_\text{eqM1}\cdot(\mat{Z}_\text{eqM1} + \mat{Z}_\text{C}^{'})^{-1}, \\
\mat{H}_\text{LNA,M} &= \mat{Z}_\text{eqLNA1}(\mat{Z}_\text{eqLNA1}+\mat{Z}_\text{eqM2})^{-1}\mat{Z}_\text{M12} \mat{Z}_\text{M11}^{-1},\quad\text{and}\\
\mat{H}_\text{L,LNA} &= R_L\mat{I}_{N_\text{Rx}}(R_L\mat{I}_{N_\text{Rx}}+\mat{Z}_\text{eqLNA2})^{-1}\mat{e}\cdot\mat{c}^{-1},
\end{align}

and therefore the overall transfer function is
\begin{align}
\label{eq:transf_func}
\mat{H}_{\text{L},i} &= 
	\mat{H}_\text{L,LNA}\cdot\mat{H}_\text{LNA,M}\cdot\mat{H}_\text{M,O'}\cdot\mat{H}_i^\text{pr},
\end{align}
including a port reduction towards receiver $i$.
As the first three sub-transfer functions ($\mat{H}_\text{L,LNA}$, $\mat{H}_\text{LNA,M}$ and $\mat{H}_\text{M,0'}$) are of size
$\mathbb{C}^{N_\text{Rx}\times N_\text{Rx}}$, the overall transfer function is of size
$\mathbb{C}^{N_\text{Rx}\times N_\text{R}\cdot\left(N_\text{Rx}+N_\text{Rel}\right)}$.
	


\subsection{Signal Covariance Matrix}
\label{sec:sig_cov}
To calculate the achievable sum rate of the systems (c.f. Section~\ref{sec:rates}), we need to derive the signal covariance matrix, defined as $\mathbb{E}[\vec{v}_{\text{L},i}^s\vec{v}_{\text{L},i}^{s^H}]$.

The overall transfer functions from $\vec{v}_i$ to $\vec{v}_{\text{L},i}^s$ can therefore be extended from Equation~\eqref{eq:transf_func} to
\begin{align}
\label{eq:transfer_function}
 \vec{v}_{\text{L},i}&= \mat{H}_\text{L,LNA}\cdot\mat{H}_\text{LNA,M}\cdot\mat{H}_\text{M,O'}
		\cdot \mat{H}_i^{\text{pr}}\cdot\mat{H}_{i}^{\text{sp}} \cdot\vec{v}_i\\\nonumber
 &=\mat{H}_{\text{L,}i}\cdot \mat{H}_{i}^{\text{sp}}\cdot\vec{v}_i,
\end{align}
and the signal covariance matrix then becomes
\begin{equation}
\label{eq:sig_cov}
\mat{K}_{\text{S},i}=%\mathbb{E}[\vec{v}_{\text{L},i}^S\vec{v}_{\text{L},i}^{S^H}] = 
	\mat{H}_\text{L,i}\cdot \mat{H}_{i}^{\text{sp}}
	\cdot\mathbb{E}[\vec{v}_i\vec{v}_i^H]\cdot
	\mat{H}_{i}^{\text{sp}^H} \cdot \mat{H}_\text{L,i}^H,
\end{equation}
where $\mat{H}_\text{L,i}$ is the transfer function including any port reduction at the receiver derived in Equation~\eqref{eq:transf_func} and $\mat{H}_{i}^{\text{sp}}$ is the transfer function over the spatial channel derived in Equation~\eqref{eq:spatial_channel}.

\subsection{Interference Covariance Matrix}
\label{sec:int_cov}

To calculate the interference covariance matrix, all of the signal sources aside from the partner (in this case, all but $i$) must be considered.
This means that all signal elements arriving at the loads of receiver $i$ must be summed up over all interferers.
The interference covariance matrix becomes 
\begin{align}
\label{eq:interf_cov}\nonumber
\mat{K}_{\text{I},i}%=\mathbb{E}[\vec{v}_{\text{L},i}^I\vec{v}_{\text{L},i}^{I^H}]
 	&= \sum_{j=0,j\neq i}^{N_\text{User}-1} 
	\mat{H}_\text{L,i} \cdot \mat{H}_{j}^{\text{sp}} \cdot 
	\mathbb{E}[\vec{v}_{j}\vec{v}_{j}^H] \cdot 
	\mat{H}_{j}^{\text{sp}^H} \cdot \mat{H}_\text{L,i}^H\\
	&= \mat{H}_\text{L,i} \cdot\left(\sum_{j=1,j\neq i}^{N_\text{User}-1} 
	\mat{H}_{j}^{\text{sp}} \cdot 
	\mathbb{E}[\vec{v}_{j}\vec{v}_{j}^H] \cdot 
	\mat{H}_{j}^{\text{sp}^H}\right) \cdot \mat{H}_\text{L,i}^H.
\end{align}


%%%%%%%%%%% Noise part %%%%%%%%%%%%
\input{chapters/noise_description}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Rate Calculations}
\label{sec:rates}

\subsection{Achievable Rate}
\label{sec:achiev_rate}
After the derivation of the signal, interference, and noise covariance matrices, we can now describe the achievable rate for each connection pair.
The achievable rate for user $j$ is described as
\begin{align}
\label{eq:achiev_rate}
\nonumber
r_j &= \text{log}_2\left(\text{det}\left(\mat{K}_{\text{S},j}\left(\mat{K}_{\text{I},j}+\mat{K}_{\text{N},j}\right)^{-1}+\mat{I}_{N_R}\right)\right)\\
 &=\text{log}_2\left(
	\text{det}\left(\mat{K}_{\text{S},j}+
		\mat{K}_{\text{I},j}+\mat{K}_{\text{N},j}\right)\right) -
	\text{log}_2\left(\text{det}\left(\mat{K}_{\text{I},j}+\mat{K}_{\text{N},j}\right)\right).
\end{align}

Stacking the achievable rates for each user into a vector leads to 
\begin{equation}
\label{eq:achiev_vec}
\vec{r} =
\begin{bmatrix}
r_0 & r_1 & \cdots & r_{N_\text{User}-1}
\end{bmatrix}^T.
\end{equation}

By this vector, we can describe the achievable sum rate as
\begin{equation}
\label{eq:achiev_sum_rate}
r_\text{Sum} = ||\vec{r}||_1,
\end{equation}
where $||\cdot||_1$ is the 1-norm, or the sum of the elements of $\vec{r}$:
\begin{equation}
\label{eq:achiev_sum_rate}
\max_{\mat{Z}_\text{M},\mat{X}_\text{Rel}}\left(r_\text{Sum}\right) = \max_{\mat{Z}_\text{M},\mat{X}_\text{Rel}}\left(\sum_{j=0}^{N_\text{User}-1} r[j]\right).
\end{equation}

\subsection{Interference Limited or Noise Free Rate}
\label{sec:sir_rate}
Another measure required in this thesis is the interference limited or noise-free rate.
It is calculated by only considering signal and interference power at the loads.
Therefore, neglecting the noise in Equation~\ref{eq:achiev_rate} leads to
\begin{align}
\label{eq:sir_rate}
r_j &=\text{log}_2\left(\text{det}\left(\mat{K}_{\text{S},j}+\mat{K}_{\text{I},j}\right)\right) -
	     	\text{log}_2\left(\text{det}\left(\mat{K}_{\text{I},j}\right)\right).
\end{align}

This is helpful for seeing how well the interference is removed by our optimization, which will be introduced in Chapter~\ref{sec:solver}.
The noise-free rate also will be denoted as the SIR-rate.


\subsection{TDMA Rate}
\label{sec:tdma_rate}
In later sections, the results achieved in this thesis are compared to existing protocols for eliminating interference, such as TDMA.
Therefore, in the following the achievable rates for the TDMA protocol will be shown.

Time in TDMA is split up in slots in which each user is allowed to transmit without any interference, so the achievable rate from Equation~\eqref{eq:achiev_rate} reduces to the interference-free achievable rate of 
\begin{align}
\label{eq:tdma_achiev_rate}
r_j  &=\frac{1}{N_\text{User}}\cdot\left(
		\text{log}_2\left(\text{det}\left(\mat{K}_{\text{S},j}+\mat{K}_{\text{N},j}\right)\right) -
	     	\text{log}_2\left(\text{det}\left(\mat{K}_{\text{N},j}\right)\right)\right).
\end{align}
It is obvious that, with no interference, this rate would be higher than the achievable rate with interference if the factor of $\frac{1}{N_\text{User}}$ was not considered.
However users are no longer allowed, to use the full transmission period, but rather only a time slot of length $\frac{1}{N_\text{User}}\cdot T_0$, where $T_0$ denotes the length of the full transmission period.
Therefore, the achievable sum rate can be written as
\begin{align}
\label{eq:tdma_achiev_sum_rate}
\nonumber
r_\text{Sum} &= ||\vec{r}||_1,\\
&= \frac{1}{N_\text{User}}\cdot \sum_{j=0}^{N_\text{User}-1} r_j.
\end{align}
The term $\frac{1}{N_\text{User}}$ is hereafter called ``pre-log" factor, and is the reason TDMA is not a good approach for a large number of users, as $N_\text{User}$ increases linearly while the advantage of an interference-free link only increases logarithmically.

There are different approaches to use TDMA, such as allowing a small number of users at the same time to transmit during one time slot.
This will lead to some interference but therefore also to a smaller pre-log factor.
Such an approach is used in the later chapters.





